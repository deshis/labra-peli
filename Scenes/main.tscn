[gd_scene load_steps=18 format=3 uid="uid://chpqcweaiakc5"]

[ext_resource type="Script" path="res://Scripts/main.gd" id="1_cx8ll"]
[ext_resource type="Script" path="res://Scripts/WorldEnvironment.gd" id="2_7q2bx"]
[ext_resource type="PackedScene" uid="uid://tr2nbcbcmnu2" path="res://Scenes/Player.tscn" id="2_d6f1p"]
[ext_resource type="Script" path="res://Scripts/DirectionalLight3D.gd" id="2_xe4gy"]
[ext_resource type="PackedScene" uid="uid://b267c0jqhpirv" path="res://Scenes/mental_asylum.tscn" id="4_b3svt"]
[ext_resource type="PackedScene" uid="uid://ekyt2ivgmsmy" path="res://Assets/monkey.glb" id="4_y0b6v"]
[ext_resource type="Script" path="res://Scripts/healthbar.gd" id="5_fvphu"]
[ext_resource type="Texture2D" uid="uid://b8ppk454bulgt" path="res://Sprites/UI/Bar/empty.png" id="5_lrdkv"]
[ext_resource type="PackedScene" uid="uid://dfbfxm4ytxuls" path="res://Scenes/enemy.tscn" id="5_rk86j"]
[ext_resource type="Texture2D" uid="uid://doceu5pqyb70l" path="res://Sprites/UI/Bar/full.png" id="6_dnqkv"]
[ext_resource type="Script" path="res://Scripts/Menu/PauseMenu.gd" id="9_5iedf"]
[ext_resource type="Script" path="res://Scripts/Menu/Button.gd" id="10_uq3l4"]
[ext_resource type="Script" path="res://Scripts/DeathScreen.gd" id="12_qcvik"]

[sub_resource type="Environment" id="Environment_p801p"]
ambient_light_color = Color(1, 1, 1, 1)
ambient_light_energy = 0.05
ssao_radius = 3.0
ssao_intensity = 5.0
ssil_radius = 12.2
ssil_intensity = 16.0
sdfgi_read_sky_light = false
sdfgi_bounce_feedback = 0.0
fog_light_color = Color(0.662745, 0.47451, 0.666667, 1)
adjustment_brightness = 0.41
adjustment_contrast = 2.66

[sub_resource type="NavigationMesh" id="NavigationMesh_7y7p8"]
vertices = PackedVector3Array(-14.2886, 33.5709, -21.7532, -14.2886, 33.5709, 6.99683, 14.4614, 33.5709, 6.99683, 14.4614, 33.5709, -21.7532, 5.4614, 13.0709, -7.75317, 5.9614, 13.0709, -6.50317, 13.9614, 13.0709, -6.50317, 13.9614, 13.0709, -21.5032, -5.2886, 13.0709, -7.75317, 5.4614, 13.0709, -7.75317, 13.9614, 13.0709, -21.5032, -14.0386, 13.0709, -21.5032, -14.0386, 13.0709, -21.5032, -14.0386, 13.0709, -7.75317, -5.2886, 13.0709, -7.75317, -5.2886, 13.0709, -3.50317, -3.2886, 13.0709, -3.50317, -3.2886, 13.0709, -5.00317, -5.2886, 13.0709, -5.00317, -5.2886, 13.0709, -5.00317, -5.7886, 13.0709, -5.50317, -14.0386, 13.0709, -7.75317, -14.0386, 13.0709, -0.75317, -5.7886, 13.0709, -3.00317, -5.2886, 13.0709, -3.50317, -14.0386, 13.0709, -0.75317, -5.7886, 13.0709, -1.25317, -5.7886, 13.0709, -3.00317, -5.7886, 13.0709, -5.50317, -5.7886, 13.0709, -7.25317, -14.0386, 13.0709, -7.75317, -14.0386, 13.0709, -0.75317, -5.2886, 13.0709, -0.75317, -5.7886, 13.0709, -1.25317, -5.7886, 13.0709, -7.25317, -5.2886, 13.0709, -7.75317, -14.0386, 13.0709, -7.75317, 5.4614, 13.0709, -5.00317, 5.4614, 13.0709, -3.50317, 5.9614, 13.0709, -2.00317, 13.9614, 13.0709, -2.00317, 13.9614, 13.0709, -6.50317, 5.9614, 13.0709, -6.50317, -3.2886, 13.0709, -5.00317, -3.2886, 13.0709, -3.50317, 5.4614, 13.0709, -3.50317, 5.4614, 13.0709, -5.00317, 5.4614, 13.0709, -0.75317, 3.9614, 13.0709, -0.75317, 4.2114, 13.0709, 6.49683, 13.9614, 13.0709, -2.00317, 5.9614, 13.0709, -2.00317, 5.4614, 13.0709, -0.75317, 4.2114, 13.0709, 6.49683, 13.9614, 13.0709, 6.49683, -4.0386, 13.0709, 6.49683, -3.7886, 13.0709, -0.75317, -5.2886, 13.0709, -0.75317, -5.2886, 13.0709, -0.75317, -14.0386, 13.0709, -0.75317, -14.0386, 13.0709, 6.49683, -4.0386, 13.0709, 6.49683, -4.0386, 13.0709, 6.49683, 4.2114, 13.0709, 6.49683, 3.9614, 13.0709, -0.75317, -3.7886, 13.0709, -0.75317)
polygons = [PackedInt32Array(3, 2, 0), PackedInt32Array(0, 2, 1), PackedInt32Array(5, 4, 6), PackedInt32Array(6, 4, 7), PackedInt32Array(9, 8, 10), PackedInt32Array(10, 8, 11), PackedInt32Array(14, 13, 12), PackedInt32Array(18, 17, 15), PackedInt32Array(15, 17, 16), PackedInt32Array(24, 23, 19), PackedInt32Array(19, 23, 20), PackedInt32Array(20, 23, 22), PackedInt32Array(20, 22, 21), PackedInt32Array(27, 26, 25), PackedInt32Array(30, 29, 28), PackedInt32Array(33, 32, 31), PackedInt32Array(36, 35, 34), PackedInt32Array(37, 42, 38), PackedInt32Array(38, 42, 39), PackedInt32Array(39, 42, 41), PackedInt32Array(39, 41, 40), PackedInt32Array(46, 45, 43), PackedInt32Array(43, 45, 44), PackedInt32Array(49, 48, 47), PackedInt32Array(52, 51, 53), PackedInt32Array(53, 51, 50), PackedInt32Array(53, 50, 54), PackedInt32Array(57, 56, 55), PackedInt32Array(59, 58, 60), PackedInt32Array(60, 58, 61), PackedInt32Array(65, 64, 62), PackedInt32Array(62, 64, 63)]
geometry_parsed_geometry_type = 2
agent_height = 2.3
agent_radius = 0.56

[sub_resource type="BoxShape3D" id="BoxShape3D_yw33l"]
size = Vector3(10.0215, 4.89069, 1)

[sub_resource type="BoxMesh" id="BoxMesh_4cslk"]

[node name="Main" type="Node3D"]
script = ExtResource("1_cx8ll")

[node name="MusicPlayer" type="AudioStreamPlayer" parent="."]
process_mode = 3
bus = &"Music"

[node name="EnemyPathfindingTimer" type="Timer" parent="."]
wait_time = 0.25
autostart = true

[node name="MainEnemySwitchTimer" type="Timer" parent="."]

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.671615, 0.599208, 0.435756, -0.740899, 0.542107, 0.396469, 0.0013413, -0.589126, 0.80804, 0, 12.4759, 0)
light_color = Color(1, 0.180392, 0.556863, 1)
light_energy = 5.0
light_indirect_energy = 10.0
light_volumetric_fog_energy = 5.0
light_angular_distance = 0.5
shadow_enabled = true
shadow_bias = 0.5
shadow_normal_bias = 5.0
shadow_opacity = 0.9
script = ExtResource("2_xe4gy")

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_p801p")
script = ExtResource("2_7q2bx")

[node name="NavigationRegion3D" type="NavigationRegion3D" parent="."]
transform = Transform3D(2.5, 0, 0, 0, 2.5, 0, 0, 0, 2.5, 0, -73.0587, 18.6366)
navigation_mesh = SubResource("NavigationMesh_7y7p8")

[node name="mental-asylum" parent="NavigationRegion3D" instance=ExtResource("4_b3svt")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 12.3209, -7.46457)

[node name="wall" type="StaticBody3D" parent="NavigationRegion3D"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="NavigationRegion3D/wall"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0078125, 15.1373, -2.19841)
shape = SubResource("BoxShape3D_yw33l")

[node name="MeshInstance3D" type="MeshInstance3D" parent="NavigationRegion3D/wall"]
transform = Transform3D(10, 0, 0, 0, 5, 0, 0, 0, 1, 0, 15.0748, -2.19841)
mesh = SubResource("BoxMesh_4cslk")
skeleton = NodePath("../..")

[node name="wall2" type="StaticBody3D" parent="NavigationRegion3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -4.09171)

[node name="CollisionShape3D" type="CollisionShape3D" parent="NavigationRegion3D/wall2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0078125, 15.1373, -2.19841)
shape = SubResource("BoxShape3D_yw33l")

[node name="MeshInstance3D" type="MeshInstance3D" parent="NavigationRegion3D/wall2"]
transform = Transform3D(10, 0, 0, 0, 5, 0, 0, 0, 1, 0, 15.0748, -2.19841)
mesh = SubResource("BoxMesh_4cslk")
skeleton = NodePath("../..")

[node name="monkey" parent="." instance=ExtResource("4_y0b6v")]
transform = Transform3D(0.999939, -0.0110303, 0, 0.0110303, 0.999939, 0, 0, 0, 1, -1.1114, -36.9156, -2.75628)

[node name="Player" parent="." instance=ExtResource("2_d6f1p")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -39.2584, 20.0543)
RUN_SPEED = 9.0

[node name="UI" type="CanvasLayer" parent="."]

[node name="TextureProgressBar" type="TextureProgressBar" parent="UI" node_paths=PackedStringArray("player")]
offset_left = 37.0
offset_top = 31.0
offset_right = 1037.0
offset_bottom = 331.0
scale = Vector2(0.21, 0.21)
texture_under = ExtResource("5_lrdkv")
texture_progress = ExtResource("6_dnqkv")
script = ExtResource("5_fvphu")
player = NodePath("../../Player")

[node name="PauseMenu" type="CanvasLayer" parent="." node_paths=PackedStringArray("ui_layer")]
process_mode = 3
script = ExtResource("9_5iedf")
ui_layer = NodePath("../UI")

[node name="PauseButtonsContainer" type="VBoxContainer" parent="PauseMenu"]
visible = false
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -46.0
offset_top = -33.0
offset_right = 46.0
offset_bottom = 33.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 3
size_flags_vertical = 3
theme_override_constants/separation = 50

[node name="ContinueButton" type="Button" parent="PauseMenu/PauseButtonsContainer"]
layout_mode = 2
size_flags_horizontal = 4
size_flags_vertical = 2
focus_neighbor_top = NodePath("../QuitGameButton")
theme_override_font_sizes/font_size = 48
text = "Continue"
script = ExtResource("10_uq3l4")

[node name="QuitGameButton" type="Button" parent="PauseMenu/PauseButtonsContainer"]
layout_mode = 2
size_flags_horizontal = 4
size_flags_vertical = 4
focus_neighbor_bottom = NodePath("../ContinueButton")
theme_override_font_sizes/font_size = 48
text = "Quit To Menu"
script = ExtResource("10_uq3l4")

[node name="DeathScreen" type="CanvasLayer" parent="." node_paths=PackedStringArray("ui_layer", "pause_layer", "player")]
follow_viewport_enabled = true
script = ExtResource("12_qcvik")
ui_layer = NodePath("../UI")
pause_layer = NodePath("../PauseMenu")
player = NodePath("../Player")

[node name="DeathButtonsContainer" type="VBoxContainer" parent="DeathScreen"]
visible = false
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -46.0
offset_top = -33.0
offset_right = 46.0
offset_bottom = 33.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 3
size_flags_vertical = 3
theme_override_constants/separation = 50

[node name="DeathText" type="RichTextLabel" parent="DeathScreen/DeathButtonsContainer"]
layout_mode = 2
theme_override_font_sizes/normal_font_size = 48
bbcode_enabled = true
text = "[center]YOU DIED"
fit_content = true
scroll_active = false

[node name="RestartButton" type="Button" parent="DeathScreen/DeathButtonsContainer"]
layout_mode = 2
size_flags_horizontal = 4
size_flags_vertical = 2
focus_neighbor_top = NodePath("../QuitGameButton")
theme_override_font_sizes/font_size = 48
text = "Restart Level"
script = ExtResource("10_uq3l4")

[node name="QuitGameButton" type="Button" parent="DeathScreen/DeathButtonsContainer"]
layout_mode = 2
size_flags_horizontal = 4
size_flags_vertical = 4
focus_neighbor_bottom = NodePath("../RestartButton")
theme_override_font_sizes/font_size = 48
text = "Quit To Menu"
script = ExtResource("10_uq3l4")

[node name="Enemy3" parent="." instance=ExtResource("5_rk86j")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 8.64314, -39.2447, 7.00848)
RUN_SPEED = 5.0
max_health = 100.0
attack_cooldown_min = 1.25
attack_cooldown_max = 2.5
attack_range = 2.5
attack_damage = 10
attack_knockback_strength = 10
footsteps_run_cooldown_time = 0.48
footsteps_walk_cooldown_time = 0.3125

[node name="Enemy4" parent="." instance=ExtResource("5_rk86j")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.471565, -39.2447, -5.65439)
RUN_SPEED = 5.0
max_health = 100.0
attack_cooldown_min = 1.25
attack_cooldown_max = 2.5
attack_range = 2.5
attack_damage = 10
attack_knockback_strength = 10
footsteps_run_cooldown_time = 0.48
footsteps_walk_cooldown_time = 0.3125

[node name="Enemy5" parent="." instance=ExtResource("5_rk86j")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.471565, -39.2447, 7.59001)
RUN_SPEED = 5.0
max_health = 100.0
attack_cooldown_min = 1.25
attack_cooldown_max = 2.5
attack_range = 2.5
attack_damage = 10
attack_knockback_strength = 10
footsteps_run_cooldown_time = 0.48
footsteps_walk_cooldown_time = 0.3125

[node name="Enemy6" parent="." instance=ExtResource("5_rk86j")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 6.51166, -38.2998, 6.56334)
WALK_SPEED = 2.0
RUN_SPEED = 5.0
max_health = 100.0
attack_cooldown_min = 1.25
attack_cooldown_max = 2.5
attack_range = 2.5
attack_damage = 10
attack_knockback_strength = 10
footsteps_run_cooldown_time = 0.48
footsteps_walk_cooldown_time = 0.3125

[node name="Enemy7" parent="." instance=ExtResource("5_rk86j")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.94313, -38.2037, -11.3088)
RUN_SPEED = 5.0
max_health = 100.0
attack_cooldown_min = 1.25
attack_cooldown_max = 2.5
attack_range = 2.5
attack_damage = 10
attack_knockback_strength = 10
footsteps_run_cooldown_time = 0.48
footsteps_walk_cooldown_time = 0.3125

[connection signal="finished" from="MusicPlayer" to="." method="_on_music_player_finished"]
[connection signal="timeout" from="EnemyPathfindingTimer" to="." method="_on_enemy_pathfinding_timer_timeout"]
[connection signal="timeout" from="MainEnemySwitchTimer" to="." method="_on_main_enemy_switch_timer_timeout"]
[connection signal="mouse_entered" from="PauseMenu/PauseButtonsContainer/ContinueButton" to="PauseMenu/PauseButtonsContainer/ContinueButton" method="_on_mouse_entered"]
[connection signal="pressed" from="PauseMenu/PauseButtonsContainer/ContinueButton" to="PauseMenu" method="_on_continue_button_pressed"]
[connection signal="mouse_entered" from="PauseMenu/PauseButtonsContainer/QuitGameButton" to="PauseMenu/PauseButtonsContainer/QuitGameButton" method="_on_mouse_entered"]
[connection signal="pressed" from="PauseMenu/PauseButtonsContainer/QuitGameButton" to="PauseMenu" method="_on_quit_game_button_pressed"]
[connection signal="mouse_entered" from="DeathScreen/DeathButtonsContainer/RestartButton" to="DeathScreen/DeathButtonsContainer/RestartButton" method="_on_mouse_entered"]
[connection signal="pressed" from="DeathScreen/DeathButtonsContainer/RestartButton" to="DeathScreen" method="_on_restart_button_pressed"]
[connection signal="mouse_entered" from="DeathScreen/DeathButtonsContainer/QuitGameButton" to="DeathScreen/DeathButtonsContainer/QuitGameButton" method="_on_mouse_entered"]
[connection signal="pressed" from="DeathScreen/DeathButtonsContainer/QuitGameButton" to="DeathScreen" method="_on_quit_game_button_pressed"]
